<!-- TODO(termie): move most of this to horizon -->
{% load sizeformat %}
{% load i18n %}
<form name="instances" class="eFilter">
</form>
<table id="instances" class="zebra-striped eSorter eFilter">
  <thead>
  <tr id='headings'>
    <th class="id"><input name="id" class="eFilterable lock" type="hidden" />{% trans "ID"%}</th>
    <th class="name"><input name="name" class="eFilterable lock" type="hidden" />{% trans "Name"%}</th>
    <th class="image" ><input name="image" class="eFilterable" type="hidden" />{% trans "Image"%}</th>
    <th class="size"><input name="size" class="eFilterable" type="hidden" />{% trans "Size"%}</th>
    <th class="ips"><input name="ips" class="eFilterable" type="hidden" />{% trans "IPs"%}</th>
    <th class="state"><input name="state" class="eFilterable" type="hidden" />{% trans "State"%}</th>
    <th class="console"><input name="console" class="eFilterable" type="hidden" />{% trans "Console"%}</th>
    <th class="actions_modal"><input name="actions_modal" class="eFilterable lock" type="hidden" />{% trans "Actions"%}</th>
  </tr>
  </thead>
  <tbody class='main'>
    {% for instance in instances %}
      <tr class="{% cycle 'odd' 'even' %}">
          <td class="id">{{instance.id}}</td>
          <td class="name">
            <a href="{% url horizon:nova:instances:detail instance.id %}">
              {{instance.name}}
              {% if instance.attrs.key_name %}
                   | 
                  <small> ({{instance.attrs.key_name}}) </small>
              {% endif %}
            </a>
          </td>
          <td class="image">{{instance.image_name}}</td>
          <td class="size">{{instance.size}}
            (<span class="details-modal-button" data-controls-modal="sd_{{instance.id}}" data-backdrop="true" data-keyboard="true">Details</span>)
            <div id="sd_{{instance.id}}" class="details-modal modal hide">
              <div class="modal-header">
              <a class="close" href="#">×</a>
              <h3>Actions for {{instance.name}}</h3>
              </div>
              <div class="modal-body">
                {{instance.attrs.memory_mb|mbformat}} Ram | {{instance.attrs.vcpus}} VCPU | {{instance.attrs.disk_gb}}GB Disk
              </div>
            <div class="modal-footer"></div>
            </div>  
          </td>
          <td class="ips">
            <span data-controls-modal="ip_{{instance.id}}" data-backdrop="true" data-keyboard="true">Show</span>
            <div id="ip_{{instance.id}}" class="details-modal modal hide">
              <div class="modal-header">
              <a class="close" href="#">×</a>
              <h3>IPs for {{instance.name}}</h3>
              </div>
              <div class="modal-body">
                {% for ip_group, addresses in instance.addresses.items %}
                  {% if instance.addresses.items|length > 1 %}
                  <h4>{{ip_group}}</h4>
                  <ul>
                    {% for address in addresses %}
                      <li>{{address.addr}}</li>
                    {% endfor %}
                  </ul>
                  {% else %}
                  <ul>
                    {% for address in addresses %}
                      <li>{{address.addr}}</li>
                    {% endfor %}
                  </ul>
                  {% endif %}
                {% endfor %}
            </div>
            <div class="modal-footer"></div>
            </div>
          </td>
          <td class="state">{{instance.status|lower|capfirst}}</td>
          <td class="console"><a target="_blank" href="{% url horizon:nova:instances:vnc instance.id %}">{% trans "VNC Console"%}</a></td>
          <td class="actions_modal">
            <span data-controls-modal="act_{{instance.id}}" data-backdrop="true" data-keyboard="true">Show</span>
            <div id="act_{{instance.id}}" class="details-modal modal hide">
              <div class="modal-header">
              <a class="close" href="#">×</a>
              <h3>Actions for {{instance.name}}</h3>
              </div>
              <div class="modal-body">
            <a class="btn small" target="_blank" href="{% url horizon:nova:instances:console instance.id %}">{% trans "Log"%}</a> <a class="btn small" href="{% url horizon:nova:instances:update instance.id %}">{% trans "Edit"%}</a> <a class="btn small" href="{% url horizon:nova:snapshots:create instance.id %}">{% trans "Snapshot"%}</a> {% include "nova/instances/_reboot.html" with form=reboot_form %} {% include "nova/instances/_terminate_link.html" with form=terminate_form %}
            </div>
            <div class="modal-footer"></div>
            </div>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
